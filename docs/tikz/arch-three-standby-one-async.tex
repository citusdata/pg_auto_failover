% Fix for: https://tex.stackexchange.com/a/315027/43228
\RequirePackage{luatex85}
\documentclass[border=10pt,17pt]{standalone}

\usepackage{cfr-lm}
\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,snakes}
\usetikzlibrary{shapes.multipart}

\begin{document}

\definecolor{pbox}{HTML}{0078D4} % MS blue
\definecolor{ptxt}{HTML}{FFFFFF} % white

\definecolor{sbox}{HTML}{50E6FF} % MS cyan
\definecolor{stxt}{HTML}{2F2F2F} % off-black

\definecolor{mbox}{HTML}{9BF00B} % MS light green
\definecolor{mtxt}{HTML}{2F2F2F} % off-black

\definecolor{apbox}{HTML}{0078D4} % MS blue
\definecolor{aptxt}{HTML}{2F2F2F} % off-black

\definecolor{async}{HTML}{FAFAFA} % very light grey

%% sans-serif fonts, large by default, and bold too
\sffamily
\sbweight
\large

\begin{tikzpicture}[>=stealth',auto,rounded corners]

  \tikzstyle{app}=[circle,thick,
	  text=aptxt,draw=apbox,fill=white,
	  line width=0.25em,minimum size=4cm]

  \tikzstyle{node}=[rectangle,minimum height=2.5cm,minimum width=4cm]

  \tikzstyle{mpnode}=[rectangle split,rectangle split parts=3,
	  text width=6.5cm,align=center,
	  rectangle split part align={center, center, left},
	  minimum height=2.5cm,minimum width=4cm,inner sep=0.5cm]

  \tikzstyle{primary}=[mpnode,text=ptxt,draw=pbox,
  	  rectangle split part fill={pbox,pbox,white}]

  \tikzstyle{standby}=[mpnode,text=stxt,draw=sbox,
	  rectangle split part fill={sbox,sbox,white}]

  \tikzstyle{monitor}=[node,text=mtxt,draw=mbox,fill=mbox]

  %% \draw [help lines] (-10,0) grid (10,20);

  \node (flegend) at (0,18) {\textbf{\textt{number\_sync\_standby = 1}}} ;

  \node  (a)   at (0,15)   [primary]
         {\textbf{Node A}
           \nodepart{second}
           \textbf{Primary}
           \nodepart[text=stxt]{third}
           \texttt{replication quorum = true} \\
           \texttt{candidate priority = 50}
         };

  \node  (b)   at (-7,2)  [standby]
         {\textbf{Node B}
           \nodepart{second}
           \textbf{Secondary}
           \nodepart[align=left]{third}
           \texttt{replication quorum = true} \\
           \texttt{candidate priority = 50}
         };

  \node  (c)   at (0,8)   [standby,rectangle split part fill={sbox,sbox,async}]
         {\textbf{Node C}
           \nodepart{second}
           \textbf{Secondary}
           \nodepart[align=left]{third}
		   \textbf{\texttt{replication quorum = false}} \\
		   \textbf{\texttt{candidate priority = 0}}
         };

  \node  (d)   at (7,2)   [standby]
         {\textbf{Node D}
           \nodepart{second}
           \textbf{Secondary}
           \nodepart[align=left]{third}
           \texttt{replication quorum = true} \\
           \texttt{candidate priority = 50}
         };

  \node  (app) at (-8,18)  [app]        {Application};
  \node  (m)   at (8,18)   [monitor]    {Monitor};

  \tikzstyle{sql}=[->,color=blue!60,text=black!90,line width=0.15em]
  \tikzstyle{sqlf}=[->,color=blue!35,text=black!90,line width=0.15em,loosely dashed]
  \tikzstyle{sr}=[>->,color=black!70,text=black!90,line width=0.15em]
  \tikzstyle{hc}=[<->,color=green!50,text=black!90,line width=0.15em,dotted]

  \path (app) edge [sql,out=0,in=180]  node[below,near start] {SQL} (a)
              edge [sqlf,out=-90,in=135]  node[left,near start] {SQL (fallback)} (b.north west)
              edge [sqlf,out=-90,in=180]  (d.west)

        (m)   edge [hc,out=-90,in=0] (a)
              edge [hc,out=-90,in=0] (b.east)
              edge [hc,out=-90,in=45] (c.north east)
              edge [hc,out=-90,in=45] node[right,near start] {Health checks} (d.north east)

        (a)   edge [sr]  (b)
              edge [sr] node[left,near start]  {\textit{Streaming}} node[right,near start] {\textit{Replication}} (c)
              edge [sr]  (d);

\end{tikzpicture}

\end{document}
